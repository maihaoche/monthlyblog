## ä¸€ã€Electron ç®€ä»‹
> Electronï¼ˆåŸåä¸ºAtom Shellï¼‰æ˜¯ GitHub å¼€å‘çš„ä¸€ä¸ªå¼€æºæ¡†æ¶ã€‚ å®ƒå…è®¸ä½¿ç”¨ Node.js å’Œ Chromium å®Œæˆæ¡Œé¢ GUI åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚

### 1ã€Electron æ˜¯ä»€ä¹ˆï¼Ÿ
![electron ç®€ä»‹](http://pic.jianhunxia.com/imgs/electronIntroduction20200819090751.png)

Electron ç›¸å½“äºç»“åˆäº†ä»¥ä¸Šä¸‰è€…çš„èƒ½åŠ›ï¼Œå¯ä»¥è®©ä½ ç”¨ web å¼€å‘çš„æ–¹å¼å»å¼€å‘æ¡Œé¢åº”ç”¨ï¼Œå¹¶ä¸”é€šè¿‡ node çš„npmåŒ…æé«˜å¼€å‘æ•ˆç‡ï¼Œåˆ©ç”¨ native çš„ api æ¥è°ƒåŠ¨åŸç”Ÿèƒ½åŠ›ã€‚

### 2ã€Electron èƒ½åšå“ªäº›åº”ç”¨
![electron apps](http://pic.jianhunxia.com/imgs/electronApps20200821094159.png)

Electron æ¶‰åŠçš„åº”ç”¨ä¼—å¤šï¼Œç›®å‰æœ€å¤šçš„æ˜¯æ•ˆç‡åº”ç”¨å’Œå¼€å‘è€…å·¥å…·ã€‚<br />
å¦‚æœæœ‰äº›ä¸šåŠ¡éœ€è¦åŒæ—¶è¿­ä»£ web å’Œæ¡Œé¢ç«¯ï¼Œé‚£ä¹ˆåŸºäº electron å°±å¯ä»¥å¤ç”¨å¤§é‡ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚

### 3ã€å­¦ä¹  electron çš„å¥½å¤„

#### å¼€å‘ä¸€äº›å®ç”¨å·¥å…·
electron å¼€å‘ä¸€äº›å°å·¥å…·å¯è°“æ˜¯æ–¹ä¾¿å¿«æ·ï¼Œæˆ‘ä»¬ç»„å†…å°ä¼™ä¼´è–¯ç‰‡æ›¾ç»å†™è¿‡ä¸€ä¸ªå¯ä»¥è·å–å„ä¸ªæµ‹è¯•ç¯å¢ƒçš„ç”¨æˆ· sessionId çš„å°å·¥å…·ï¼Œè®©å¼€å‘æµ‹è¯•ä½“éªŒæ— æ¯”é¡ºç•…ï¼Œä¸éœ€è¦å†å»æŸ¥åº“äº†ã€‚

#### æé«˜æŠ€æœ¯æ·±åº¦å¹¿åº¦
å­¦ä¹  electron çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä» web ç«¯æ‰©å±•åˆ°æ¡Œé¢ç«¯ï¼Œå¹¶ä¸”å¯¹äºæµè§ˆå™¨æ¸²æŸ“ã€ç³»ç»Ÿèƒ½åŠ›è°ƒç”¨éƒ½æœ‰ä¸€ä¸ªæ›´æ·±çš„ç†è§£ã€‚

### 4ã€electron ä¸å¸¸è§çš„æ¡Œé¢ç«¯å¼€å‘æŠ€æœ¯å¯¹æ¯”
![electronä¸å…¶ä»–æŠ€æœ¯å¯¹æ¯”](http://pic.jianhunxia.com/imgs/electronCompare20200823123245.png)

electronçš„ä¼˜ç‚¹æœ‰æ”¯æŒè·¨å¹³å°ã€ä½¿ç”¨webæŠ€æœ¯å¼€å‘ã€ç¤¾åŒºå¾ˆæ´»è·ƒã€æœ‰å¤šä¸ªæˆåŠŸçš„å¤§å‹åº”ç”¨æ¡ˆä¾‹ï¼Œç¼ºç‚¹æ˜¯æ‰“åŒ…ä½“ç§¯è¾ƒå¤§ï¼ˆåŒ…å«chromiumï¼‰ã€æ€§èƒ½ä¸€èˆ¬ï¼ˆè¾ƒåŸç”Ÿï¼‰ã€‚

## äºŒã€Electron é¡¹ç›®ç®€å•äº†è§£

å¼€å‘ electron éœ€è¦ä¸€äº›ç®€å•çš„ç¯å¢ƒé…ç½®ï¼Œè¿™é‡Œç®€å•çœ‹ä¸‹ã€‚<br/>

1. é¦–å…ˆä½ éœ€è¦ä¸€ä¸ªå¥½ç”¨çš„ç¼–è¾‘å™¨ï¼Œè¿™é‡Œæ¨è VScodeã€Atomï¼Œå› ä¸ºå®ƒä»¬ç”¨ electron å¼€å‘çš„éå¸¸æµè¡Œçš„ç¼–è¾‘å™¨ï¼Œå¯¹ electron çš„æ”¯æŒä¹Ÿéå¸¸å¥½ã€‚
2. å…¶æ¬¡è¦å®‰è£…å¥½ nodejs å’Œ npmï¼Œå»ºè®®ä½¿ç”¨ [nvm](https://www.cnblogs.com/kaiye/p/4937191.html) æ¥ç®¡ç† node ç‰ˆæœ¬ï¼Œæ–¹ä¾¿å¿«æ·å®ç”¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ å–œæ¬¢ç”¨ [yarn](https://yarn.bootcss.com/docs/getting-started/) æ¥ä»£æ›¿ npm çš„è¯ä¼šæ›´å¥½ã€‚

æ¥ä¸‹æ¥äº†è§£ä¸‹ electron ä¸­çš„ä¸¤ç§ä¸»è¦è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ã€‚<br/>
![electron è¿›ç¨‹](http://pic.jianhunxia.com/imgs/electronPrecess20200823205752.png)
Electron è¿è¡Œ package.json çš„ main è„šæœ¬çš„è¿›ç¨‹è¢«ç§°ä¸ºä¸»è¿›ç¨‹ã€‚ åœ¨ä¸»è¿›ç¨‹ä¸­è¿è¡Œçš„è„šæœ¬é€šè¿‡åˆ›å»ºwebé¡µé¢æ¥å±•ç¤ºç”¨æˆ·ç•Œé¢ï¼Œä¸€ä¸ª Electron åº”ç”¨æ€»æ˜¯æœ‰ä¸”åªæœ‰ä¸€ä¸ªä¸»è¿›ç¨‹ã€‚

ç”±äº Electron ä½¿ç”¨äº† Chromium æ¥å±•ç¤º web é¡µé¢ï¼Œæ‰€ä»¥ Chromium çš„å¤šè¿›ç¨‹æ¶æ„ä¹Ÿè¢«ä½¿ç”¨åˆ°ã€‚ æ¯ä¸ª Electron ä¸­çš„ web é¡µé¢è¿è¡Œåœ¨å®ƒçš„å«æ¸²æŸ“è¿›ç¨‹çš„è¿›ç¨‹ä¸­ã€‚

ç»ˆäºè¦å¼€å§‹æ­å»ºä¸€ä¸ªæœ€ç®€å•çš„ electron åº”ç”¨äº†ï¼ŒLet's beginï¼

1. å®‰è£… electron å¹¶åˆå§‹åŒ–é¡¹ç›®

```
yarn init                   // åˆå§‹åŒ– package.json
yarn add electron           // å®‰è£… electron

```

2. æ·»åŠ  web é¡µé¢ index.html

```
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
  </head>
  <body>
    <h1>Hello World! I am jianhao</h1>
  </body>
</html>

```
3. æ·»åŠ ä¸»è¿›ç¨‹ main.js

```
const { app, BrowserWindow } = require('electron') // ä»electron ä¸­å¼•å…¥ä¸»æ¨¡å—å’Œçª—å£æ¨¡å—

// åˆ›å»ºæµè§ˆå™¨çª—å£
function createWindow () {   
  const win = new BrowserWindow({
    width: 800,
    height: 600,
    webPreferences: {
      nodeIntegration: true
    }
  })

  // å¹¶ä¸”ä¸ºä½ çš„åº”ç”¨åŠ è½½index.html
  win.loadFile('index.html')
}

app.whenReady().then(createWindow)

```
4. ä½¿ç”¨ä¸»è¿›ç¨‹ä½œä¸ºå…¥å£ï¼Œå¹¶ç”¨ electron å‘½ä»¤å¯åŠ¨é¡¹ç›®

```
// åœ¨ package.json ä¸­æ·»åŠ 
"main": "main.js",
"scripts": {
    "start": "electron ." 
}

```
![electron app](http://pic.jianhunxia.com/imgs/electronFirstApp20200823220750.png)

ç„¶åä½ å°±ä¼šçœ‹åˆ°ä¸€ä¸ªæœ€ç®€å•çš„ electron åº”ç”¨äº†ï¼Œä¸€åˆ‡éƒ½å¾ˆä¸æ»‘é¡ºç•…, ä¸æ˜¯ä¹ˆ<br/>
å…ˆå»å¬å¬éŸ³ä¹ç„¶åç¡è§‰ï¼ŒğŸ§ æ˜å¤©ç»§ç»­âœ¨âœ¨âœ¨ï¼
10:23 PM 


## ä¸‰ã€Electron + Umi3 æ­å»ºæ¡Œé¢åº”ç”¨
é‡å¤´æˆæ¥äº†ï¼Œæˆ‘ä»¬å°†ä¼šæ­å»ºä¸€ä¸ªåŸºç¡€çš„ electron åº”ç”¨ï¼Œå› ä¸ºæœ€è¿‘ç”¨ Umi æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ç›´æ¥ Umi é…åˆ electron æ„å»ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–è„šæ‰‹æ¶æ­å»ºï¼Œæ¯”å¦‚ [electron-vue](https://simulatedgreg.gitbooks.io/electron-vue/content/cn/)

é¦–å…ˆæˆ‘ä»¬å‚è€ƒ [Umi æ–‡æ¡£](https://umijs.org/zh-CN/docs)ã€[Umi3 æ­å»ºé¡¹ç›®](https://juejin.im/post/6854573221782487047) æ¥æ­å»ºä¸€ä¸ªé¡¹ç›®ï¼Œ
[å‚è€ƒdemo](https://github.com/jianhao/umi-mobile)ï¼Œå¤§è‡´ç›®å½•å¦‚ä¸‹ï¼š

    â”œâ”€â”€ dist/                           // é»˜è®¤çš„ build è¾“å‡ºç›®å½•
    â”œâ”€â”€ mock/                           // mock æ–‡ä»¶æ‰€åœ¨ç›®å½•
    â””â”€â”€ config/
        â”œâ”€â”€ config.js                   // umi é…ç½®ï¼ŒåŒ .umirc.jsï¼ŒäºŒé€‰ä¸€
        â”œâ”€â”€ routers.js                  // è·¯ç”±é…ç½®
    â””â”€â”€ src/
        â”œâ”€â”€ layouts/index.js            // å…¨å±€å¸ƒå±€
        â”œâ”€â”€ assets                      // é™æ€èµ„æº
        â”œâ”€â”€ components                  // å…¬å…±ç»„ä»¶
        â”œâ”€â”€ models                      // å…¨å±€ models
        â”œâ”€â”€ services                    // services
        â”œâ”€â”€ styles                      // æ ·å¼æ–‡ä»¶
        â”œâ”€â”€ utils                       // å·¥å…·æ–‡ä»¶
        â””â”€â”€ pages/                      // é¡µé¢ç›®å½•
        â”œâ”€â”€ global.less                 // è‡ªåŠ¨å¼•å…¥çš„å…¨å±€æ ·å¼
        â”œâ”€â”€ app.js                      // è¿è¡Œæ—¶é…ç½®æ–‡ä»¶
    â”œâ”€â”€ .umirc.js                       // umi é…ç½®ï¼ŒåŒ config/config.jsï¼ŒäºŒé€‰ä¸€
    â”œâ”€â”€ .editorconfig                   // ç»´æŠ¤ä»£ç é£æ ¼çš„é…ç½®æ–‡ä»¶
    â”œâ”€â”€ .eslintignore                   // eslint å¿½ç•¥æ–‡ä»¶
    â”œâ”€â”€ .eslintrc.js                    // eslint é…ç½®æ–‡ä»¶
    â”œâ”€â”€ .gitignore                      // git è¦å¿½ç•¥çš„æ–‡ä»¶
    â”œâ”€â”€ .prettierignore                 // Prettier è¦å¿½ç•¥çš„æ–‡ä»¶
    â”œâ”€â”€ .prettierrc.js                  // Prettier ä»£ç æ ¼å¼åŒ–é…ç½®æ–‡ä»¶ 
    â”œâ”€â”€ .stylelintrc.js                 // css ä»£ç å®¡æŸ¥çš„é…ç½®æ–‡ä»¶
    â”œâ”€â”€ jsconfig.jso                    // js é…ç½®æ–‡ä»¶
    â”œâ”€â”€ package.json                    // npm ä¾èµ–è®°å½•æ–‡ä»¶
    â””â”€â”€ yarn.lock                       // yarn ç‰ˆæœ¬é”å®šæ–‡ä»¶

æ¥ä¸‹æ¥æˆ‘ä»¬å°†å…¶æ”¹é€ æˆ electron é¡¹ç›®ã€‚<br/>

### 1ã€æ”¹é€ é¡¹ç›®ç»“æ„
srcç›®å½•ä¸‹æ–°å»º render å’Œ main ç›®å½•ï¼Œç„¶åå°†åŸæ¥ src æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶å’Œç›®å½•å…¨éƒ¨ç§»åŠ¨åˆ° render ç›®å½•ä¸­ï¼Œå†å°† config ç›®å½•å’Œ .umirc æ–‡ä»¶ä¹Ÿæ”¾è¿›å»ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚

éœ€è¦ä¿®æ”¹ä¸‹ä¸‹é¡¹ç›®æ ¹ç›®å½•ï¼Œä¸ç„¶é¡¹ç›®æ— æ³•å¯åŠ¨ï¼š

```
yarn add cross-env   // è·¨å¹³å°è®¾ç½®å’Œä½¿ç”¨ç¯å¢ƒå˜é‡çš„è„šæœ¬åŒ…
"start": "cross-env APP_ROOT=src/render umi dev" // ä¿®æ”¹ start å‘½ä»¤, å°† app æ ¹ç›®å½•æ”¹ä¸º src/render
```

### 2ã€electron æœ¬åœ°å¯åŠ¨
é¦–å…ˆå®‰è£…éœ€è¦ç”¨åˆ°çš„ä¾èµ–

```
yarn add concurrently  // å¹¶å‘è¿è¡Œå¤šä¸ªå‘½ä»¤çš„åŒ…
yarn add wait-on  // ç­‰å¾…æ–‡ä»¶ã€ç«¯å£ã€èµ„æºå¯ç”¨å†æ‰§è¡Œå‘½ä»¤çš„åŒ…
yarn add wait-on // electron æœ¬å°Š
```
ç„¶åä¿®æ”¹ start å‘½ä»¤ï¼Œç­‰å¾…æœ¬åœ°æœåŠ¡èµ·æ¥å†é€šè¿‡ electron å¯åŠ¨åº”ç”¨

```
"start": "concurrently \"npm run start:web\" \"wait-on http://localhost:9527 && electron .\"",
"start:web": "cross-env NODE_ENV=development APP_ROOT=src/render PORT=9527 umi dev",
```
æ·»åŠ ä¸€ä¸ªä¸»è¿›ç¨‹æ–‡ä»¶ src/main/main.js, å†…å®¹å¦‚ä¸‹ï¼š

```
// eslint-disable-next-line import/no-extraneous-dependencies
const { app, BrowserWindow} = require('electron')
const isDev = process.env.NODE_ENV === 'development'

function createWindow () {
  let mainWindow = new BrowserWindow({ // å®ä¾‹åŒ–ä¸€ä¸ªçª—å£
    width: 1200,
    height: 900,
    webPreferences: {
      contextIsolation: false,
      nodeIntegration: true, // node é›†æˆï¼Œå¯ä»¥ä½¿ç”¨ require å’Œ process è¿™æ ·çš„node APIs å»è®¿é—®ä½å±‚ç³»ç»Ÿèµ„æº
    }
  })
  process.env.ELECTRON_DISABLE_SECURITY_WARNINGS = 'true' // ç¦ç”¨æ§åˆ¶å°

  if (!isDev) {
    mainWindow.loadURL('http://localhost:9527/')
    mainWindow.webContents.openDevTools()
  }
  mainWindow.on('closed', () => {
    mainWindow = null
  })
}
app.on('ready', createWindow) // åº”ç”¨åˆå§‹åŒ–åæ‰“å¼€çª—å£
app.on('quit', () => { })

```
åœ¨ package.json ä¸­å°†ä¸»è¿›ç¨‹æ–‡ä»¶é…ç½®ä¸ºé¡¹ç›®å…¥å£

```
"main": "./src/main/main.js",
```
ç„¶åå¯åŠ¨é¡¹ç›®

```
yarn start
```
å“‡å“¦ï¼Œumi + electron æœ¬åœ°å¼€å‘ç»“åˆæˆåŠŸäº†ï¼å€¼å¾—åƒå‡ å— ğŸ‰ğŸ‰ğŸ‰

### 3ã€electron æ‰“åŒ…ç¼–è¯‘
å¼€å‘å¥½äº†æˆ‘ä»¬çš„å°å·¥å…·ï¼Œè¿™æ—¶å€™å°±è¦æ‰“åŒ…ç»™å…¶ä»–åŒå­¦ä½¿ç”¨äº†ã€‚ç›®å‰æµè¡Œçš„æ‰“åŒ…æ–¹æ¡ˆæœ‰ [electron-forge](https://github.com/electron-userland/electron-forge)ã€[electron-packager](https://github.com/electron/electron-packager)ã€[electron-builder](https://github.com/electron-userland/electron-builder)ã€‚

æœ¬æ¥æˆ‘ç”¨çš„ electron-forge æ­å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼Œç›®å‰æ˜¯v6ç‰ˆæœ¬å¾ˆä¸ç¨³å®šï¼Œåæ¥æˆ‘å†æ¬¡æ­å»ºæ­»æ´»æ•´ä¸å‡ºæ¥ï¼Œé‚å¼ƒå‘ã€‚ç›®å‰æ¨è electron-builderï¼Œstar 9.5kï¼Œç¤¾åŒºæ¯”è¾ƒæ´»è·ƒï¼Œæˆ‘ç”¨äº†ä¸‹æ„Ÿè§‰è¿˜æ˜¯éå¸¸ä¸æ»‘çš„ã€‚

å¼€æ•´ï¼ï¼ï¼

å®‰è£… electron-builder åˆ°å¼€å‘ä¾èµ–

```
yarn add electron-builder
```

package.json ä¸­æ·»åŠ é¡¹ç›®ä¿¡æ¯ã€æ‰“åŒ…å‘½ä»¤ã€æ‰“åŒ…é…ç½®

```
  "name": "thresh",
  "private": true,
  "version": "0.1.0",
  "productName": "Thresh",
  "description": "ç»“åˆ umi3 + electron + node æ„å»ºæ¡Œé¢åº”ç”¨çš„ä¸€ä¸ªdemo",
  "scripts": {
    "build": "electron-builder build -m", // -m mac -w windows -l linux
  },
  "build": {
    "productName": "electron-demos",
    "files": [
      "src/main/",  // ä¸»è¿›ç¨‹æ–‡ä»¶
    ],
    "dmg": {
      "contents": [
        {
          "x": 110,
          "y": 150
        },
        {
          "x": 240,
          "y": 150,
          "type": "link",
          "path": "/Applications"
        }
      ]
    },
    "win": {
      "target": [
        {
          "target": "nsis",
          "arch": [
            "x64"
          ]
        }
      ]
    },
    "directories": {
      "output": "release" // æ‰“åŒ…æ–‡ä»¶è¾“å‡ºç›®å½•
    }
  },
```
ä¸»è¿›ç¨‹æ–‡ä»¶æ·»åŠ é…ç½®

```
// eslint-disable-next-line import/no-extraneous-dependencies
const { app, BrowserWindow} = require('electron')
+ const path = require('path')
+ const url = require('url')

const isDev = process.env.NODE_ENV === 'development'

function createWindow () {
  let mainWindow = new BrowserWindow({ // å®ä¾‹åŒ–ä¸€ä¸ªçª—å£
    width: 1200,
    height: 900,
    webPreferences: {
      contextIsolation: false,
      nodeIntegration: true, // node é›†æˆï¼Œå¯ä»¥ä½¿ç”¨ require å’Œ process è¿™æ ·çš„node APIs å»è®¿é—®ä½å±‚ç³»ç»Ÿèµ„æº
    }
  })
  process.env.ELECTRON_DISABLE_SECURITY_WARNINGS = 'true' // ç¦ç”¨æ§åˆ¶å°

  if (isDev) {
    mainWindow.loadURL('http://localhost:9527/')
    mainWindow.webContents.openDevTools()
  } else{
+    mainWindow.loadURL(
+      url.format({
+        pathname: path.join(__dirname, './index.html'), // è¦æ¸²æŸ“çš„é™æ€é¡µé¢
+        protocol: 'file:',
+        slashes: true,
+      }),
+    )
+    mainWindow.webContents.openDevTools()
  }
  mainWindow.on('closed', () => {
    mainWindow = null
  })
}
app.on('ready', createWindow) // åº”ç”¨åˆå§‹åŒ–åæ‰“å¼€çª—å£
app.on('quit', () => { })
```
ç„¶åæ·»åŠ ä¸€ä¸ªé™æ€é¡µé¢ src/main/index.html, å†…å®¹å¦‚ä¸‹ï¼š

```
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.2.10
    </script>
  </head>
  <body>
    <div id="root" style="margin: 100px auto;color: skyblue;font-size: 40px;text-align: center;">
      æˆ‘æ˜¯ä¸€ä¸ªæ²¡æœ‰æ„Ÿæƒ…çš„é™æ€é¡µé¢
    </div>
  </body>
</html>
```
é¡¹ç›®æ‰“åŒ…

```
yarn build
```
ç„¶åæ ¹ç›®å½• release/mac/ ä¸­å°±æ˜¯æ‰“åŒ…å¥½çš„é¡¹ç›®ï¼ŒåŒå‡»æ‰“å¼€å³å¯
![æ‰“åŒ… demo](http://pic.jianhunxia.com/imgs/electron-builder-demo20200901165840.png)

è¿™é‡Œè¯´æ˜ electron-builder æ‰“åŒ…ç¼–è¯‘ electron æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦å°† umi ç¼–è¯‘çš„èµ„æºä¹Ÿæ‰“åŒ…è¿›å»å¹¶æ¸²æŸ“å‡ºæ¥ã€‚

### 4ã€å¯åŠ¨ node æœåŠ¡è®¿é—®èµ„æº
é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œumi3 ç¼–è¯‘å‡ºæ¥çš„éƒ½æ˜¯å•é¡µé¢åº”ç”¨çš„èµ„æºï¼Œä¸èƒ½é€šè¿‡æµè§ˆå™¨ç›´æ¥è®¿é—®è·¯ç”±é¡µé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡ nginx æˆ–è€… node æ¥è®¿é—®è¯¥èµ„æºã€‚

ä¿®æ”¹ umi3 é…ç½®ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯ config.js 
```
  outputPath: '../dist',
  <!--é’ˆå¯¹ electron ç¼–è¯‘ï¼Œå‚è€ƒï¼šhttps://webpack.js.org/configuration/target/#string -->
  chainWebpack: (config) => { config.target('electron-renderer') },  
```
æ·»åŠ  src/server/index.js , å†…å®¹å¦‚ä¸‹ï¼š

```
const compression = require('compression') // gzipå‹ç¼©çš„ä¸­é—´ä»¶ï¼Œå°½å¯èƒ½å…ˆåŠ è½½è¿™ä¸ª
const express = require('express')
const http = require('http')
const history = require('connect-history-api-fallback') // å½“è·¯ç”±æ¨¡å¼ä¸ºhistoryçš„æ—¶å€™ï¼Œåç«¯ä¼šç›´æ¥è¯·æ±‚åœ°å€æ ä¸­çš„æ–‡ä»¶ï¼Œè¿™æ ·å°±ä¼šå‡ºç°æ‰¾ä¸åˆ°çš„æƒ…å†µï¼Œéœ€è¦è¿™ä¸ªä¸­é—´ä»¶å¤„ç†è·¯ç”±
const { createProxyMiddleware } = require('http-proxy-middleware') // ä»£ç†æœ¬åœ°è¯·æ±‚ï¼Œå®ç°è·¨åŸŸ
const path = require('path')

const port = 3009
const app = express()
const httpServer = http.createServer(app)
const proxyTable = { // ä»£ç†åˆ°ä¸åŒæœåŠ¡å™¨ä¸åŒç«¯å£çš„è¯·æ±‚
  'api-1': 'https://XXX.com/api',
  'api-2': 'https://XXX.net/api',
}

const creatServer = () => {
  app.use(compression()) // æœåŠ¡å™¨ç«¯gzipæ–‡ä»¶å‹ç¼©

  // å»è®¾ç½®ä¸åŒçš„ä»£ç†
  Object.keys(proxyTable).map((key) => {
    const pathRewrite = {}
    pathRewrite[`^/${key}`] = ''
    app.use(`/${key}`, createProxyMiddleware({ // proxyåå‘ä»£ç†
      target: proxyTable[key],
      changeOrigin: true,
      pathRewrite
    }))
  })
  // å¤„ç†å•é¡µé¢ history è·¯ç”±ï¼Œå½“è¯·æ±‚æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ—¶å€™ï¼Œè¯¥åº“ä¼šæŠŠè¯·æ±‚åœ°å€è½¬åˆ°é»˜è®¤ï¼ˆé»˜è®¤æƒ…å†µä¸ºindex.htmlï¼‰
  app.use(history({ 
    index: './index.html'
  }))
  // express.static: å†…ç½®ä¸­é—´ä»¶å‡½æ•°,æŒ‡å®šèµ„äº§çš„ç›®å½•
  app.use(express.static(path.join(__dirname, '../dist'))) 
  // ç›‘å¬å¯åŠ¨çš„æœåŠ¡
  httpServer.listen(port, (err) => {
    if (err) {
      console.log(err)
      return
    }
    console.log(`%c your server is running at http://localhost:${port}\n`, 'color: skyblue')
  })
}

module.exports = { creatServer }
```
ä¸Šé¢å·²ç»åŠ äº†æ³¨é‡Šï¼Œä¸»è¦ä½œç”¨å°±æ˜¯åŸºäºexpress å¯åŠ¨ä¸€ä¸ª node æœåŠ¡ï¼Œç”¨æ¥ä»£ç†æ¥å£å’Œè®¿é—®é™æ€èµ„æºï¼Œç„¶åæˆ‘ä»¬å»ä¸»è¿›ç¨‹ä¸­å»å¯åŠ¨è¯¥æœåŠ¡ã€‚

```js
<!--src/main/main.js-->
const { creatServer } = require('../server/index')
if (isDev) {
    mainWindow.loadURL('http://localhost:9527/')
    mainWindow.webContents.openDevTools()
} else {
    creatServer()
    mainWindow.loadURL('http://localhost:3009/')
    mainWindow.webContents.openDevTools()
}
```

ç„¶åå®‰è£…ä¸‹ç”¨åˆ°çš„ä¾èµ–

```
yarn add compression express connect-history-api-fallback http-proxy-middleware
```
æœ€åå»ä¿®æ”¹ä¸‹ package.json çš„é…ç½®å’Œå¯åŠ¨å‘½ä»¤

```
<!--æ‰“åŒ…å‘½ä»¤-->
"scripts": {
    "build": "npm run build:web && electron-builder build -m",
    "build:web": "cross-env NODE_ENV=production APP_ROOT=src/render umi build",
}
<!--è¦æ‰“åŒ…çš„èµ„æºï¼Œä¸€å®šä¸è¦å¿˜è®°æ·»åŠ ï¼ï¼ï¼-->
"build": {
    "productName": "Thresh",
    "files": [
      "src/dist/",
      "src/main/",
      "src/render/",
      "src/server/"
    ],
    ...
}
```
è‡³æ­¤ï¼ŒåŸºæœ¬é…ç½®å·²ç»å®Œå–„ï¼Œæˆ‘ä»¬æ¥æ‰“åŒ…ç¼–è¯‘ä¸‹æˆ‘ä»¬çš„åº”ç”¨
```
yarn build
```
æ‰“åŒ…æˆåŠŸåæ‰“å¼€æˆ‘ä»¬çš„åº”ç”¨ï¼
![image](http://pic.jianhunxia.com/imgs/electron-builder-demo220200902095617.png)

ç»ˆäºæå®Œäº†ï¼ï¼ï¼æˆ‘è¾¹æ­å»ºè¾¹å†™è¿™ç¯‡æ•™ç¨‹ï¼Œä¸­é—´æ•°æ¬¡å¡ä½ï¼Œäº‹å®è¯æ˜ï¼Œè¿™æ ·æå®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚

å¾—åˆ°çš„ç»éªŒå°±æ˜¯å¦‚æœè¢«æŸä¸ªé—®é¢˜å›°æ‰°è®¸ä¹…ï¼Œä¸å¦‚åœä¸‹æ¥æ‰“æ‰“æ¸¸æˆï¼Œå–æ¯å•¤é…’ï¼Œå¥½å¥½ç¡ä¸€è§‰ï¼Œé—®é¢˜ä¼šåœ¨ç¬¬äºŒå¤©æ¸…æ™¨è¿åˆƒè€Œè§£ âœ¨âœ¨âœ¨    



